<<<<<<< HEAD
# gitterraf
Terraform + GitLab CI/CD для развертывания Telegram-бота в Yandex.Cloud. Проект автоматизирует развёртывание инфраструктуры и деплой Telegram-бота MyAkzinfoBot. Решение позволяет собирать метрики, отправлять их в Yandex Monitoring и интегрироваться с Telegram для получения уведомлений о состоянии инфраструктуры и пайплайнов.
=======
# Terraform + GitLab CI/CD for Telegram Bot Deployment in Yandex.Cloud

## Описание проекта

Проект автоматизирует развёртывание инфраструктуры и деплой Telegram-бота MyAkzinfoBot. Решение позволяет собирать метрики, отправлять их в Yandex Monitoring и интегрироваться с Telegram для получения уведомлений о состоянии инфраструктуры и пайплайнов.

## Основные функции

### Telegram-бот MyAkzinfoBot

- **Ссылка на бота**: @OprosinfaBot.
- **Запуск**: работает в Docker-контейнере.
- **Функционал**: предоставляет данные о ценах закрытия и объёмах торгов за последний месяц для акций "AAPL" и "MSFT".
- **Интерфейс**: через Telegram пользователь запрашивает данные, которые бот возвращает в структурированном виде.

### Инфраструктура на Yandex.Cloud

- Виртуальная машина разворачивается с помощью **Terraform**.
- На виртуальную машину автоматически устанавливается:
  - **Yandex Unified Agent** для сбора метрик.
  - **Docker** для запуска контейнера с Telegram-ботом.
- **Yandex Unified Agent**:
  - Собирает данные о состоянии машины (загрузка CPU, RAM, использование дисков и т.д.).
  - Отправляет метрики **Yandex Monitoring**.
- **Yandex Monitoring**:
  - Показывает метрики в виде дашбордов.
  - Отправляет обновления в Telegram-бот @YandexCloudNotify_bot.

### Инфраструктура на Yandex.Cloud

- Пайплайн автоматизирует процесс деплоя:
  - Развёртывание инфраструктуры с помощью Terraform.
  - Построение Docker-образа с ботом.
  - Деплой образа на виртуальную машину.
- **Yandex Unified Agent**:
  - Webhook-события в GitLab отправляют уведомления в Telegram-канал Gitlabtest (ссылка на телеграм канал: https://t.me/gitlabtestinfo).
  - События включают ошибки пайплайнов, их успешное завершение и запуск новых.

## Структура проекта

.
├── .gitlab-ci.yml # Конфигурация CI/CD для GitLab
├── botinfoakz.py # Основной скрипт Telegram-бота
├── config2.py # Дополнительная конфигурация
├── config.yml # Конфигурация Yandex Unified Agent
├── Dockerfile # Docker-образ для Telegram-бота
├── environments # Папка с Terraform-окружениями
│ └── staging # Конфигурация для staging-окружения
│ ├── main.tf # Основной Terraform-скрипт
│ ├── outputs.tf # Выходные переменные
│ ├── terraform.tfstate # Состояние Terraform
│ ├── terraform.tfvars # Значения переменных Terraform
│ └── variables.tf # Описание переменных Terraform
├── key.json # Ключ сервисного аккаунта Yandex.Cloud
├── README.md # Документация проекта
└── requirements.txt # Python-зависимости

## Основные этапы работы

### 1. Развёртывание инфраструктуры

- Terraform создаёт виртуальную машину в Yandex.Cloud:
  - Настраиваются сеть, диски, SSH-доступ.
  - На машину автоматически устанавливаются **Yandex Unified Agent и Docker**
- Yandex Unified Agent собирает метрики и отправляет их в Yandex Monitoring.

### 2. Запуск Telegram-бота

- Docker-образ Telegram-бота собирается на основе Dockerfile.
- В контейнере запускается основной скрипт бота (botinfoakz.py).
- Контейнер разворачивается на виртуальной машине.

### 3. Сбор и передача метрик

- **Yandex Unified Agent и Docker**:
  - Снимает показания с виртуальной машины: загрузка процессора, оперативная память, диски и т.д.
  - Отправляет данные в **Yandex Monitoring**
- Yandex Unified Agent собирает метрики и отправляет их в Yandex Monitoring.
- **Telegram-бот для метрик**:
  - Запрашивает метрики через Yandex Monitoring API.
  - Форматирует данные и отправляет уведомления в Telegram-чат @YandexCloudNotify_bot.

### 4. Уведомления о GitLab пайплайнах

- **GitLab Webhooks**:
  - Генерируют уведомления о событиях пайплайна (ошибки, успехи, запуск).
  - Уведомления отправляются в Telegram-канал: @Gitlabtest.

## Как настроить проект

### Шаг 1: Предварительные требования

- **Terraform**: Установите версию 1.3.6 или выше.
- **Python 3**: Настройте виртуальное окружение и установите зависимости из requirements.txt.
- **Docker**: Убедитесь, что Docker установлен на локальном устройстве и виртуальной машине.
- **Yandex.Cloud CLI**: Настройте CLI и создайте ключ сервисного аккаунта (key.json).

### Шаг 2: Настройка переменных

- В файле terraform.tfvars укажите:
  - Идентификаторы облака и папки Yandex.Cloud.
  - Размеры ресурсов виртуальной машины.
  - SSH-ключи для доступа.
  - Данные для Docker Registry.
- Настройте variables.tf для корректной конфигурации **Unified Agent**.

### Шаг 3: Настройка GitLab CI/CD

- Включите GitLab CI/CD, используя файл .gitlab-ci.yml.
- Добавьте переменные в настройки репозитория:
  - YC_SERVICE_ACCOUNT_KEY — ключ сервисного аккаунта Yandex.Cloud.
  - SSH_PRIVATE_KEY, SSH_PUBLIC_KEY — ключи для SSH-доступа.
  - DOCKER_USERNAME, DOCKER_PASSWORD — учётные данные для Docker Registry.

### Шаг 4: Запуск пайплайна

1. Пушьте изменения в репозиторий GitLab.
2. Запустите пайплайн вручную или дождитесь его автоматического запуска.

Этот README включает все важные детали проекта.

### Поддержка

Посмотреть автоматическую сборку и деплой приложения можно в моем приватном репозитории GitLab.
Если у вас возникли вопросы или проблемы, свяжитесь со мной:

Автор: Alex
Email: [vla56240@gmail.com]
Telegram: [@robotsinfo]
>>>>>>> 697d351 (Файлы проекта Terraform + GitLab CI/CD)
